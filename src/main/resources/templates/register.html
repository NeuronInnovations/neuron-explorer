<!DOCTYPE html>
<html lang="en">

    <head>
        <title> Neuron {#insert title} {/}</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
        <meta name="theme-color" content="#000000">
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">
        <link rel="stylesheet" href="https://unpkg.com/material-components-web@8.0.0/dist/material-components-web.min.css">
        {!<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">!}

        <link rel="stylesheet" href="styles/custom.less" />
        {#insert stylesheets}
        {/}
        <script src="//cdn.jsdelivr.net/npm/less" ></script>
        <script src="https://unpkg.com/material-components-web@8.0.0/dist/material-components-web.min.js"></script>
        <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>-->
        <!--<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-crosshair@1.1.6"></script>-->
        <!--<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ccxt@1.33.17/dist/ccxt.browser.js"></script>-->
        <style>
            label {
                width: 100%;
            }
            td {
                padding:8px 0px;
            }
        </style>
    </head>

    <body style=" 
          background: var(--mdc-theme-primary);

          ">

        <div id="fullScreenOverlay" class="fullScreenOverlay">
            <a href="javascript:void(0)" class="closebtn" onclick="closeFullScreenMap()">&times;</a>
            <div class="fullScreenOverlay-content">

            </div>
        </div>

        <div style="
             display: table;

             width: 100%;
             margin: 0 auto;
             box-shadow: 1px 1px 5px rgba(0, 0, 0, 0.1)
             ">
            <div id='mega-image'
                 style="
                 display: table-cell;
                 width: auto;
                 background: url(/images/header-background.png);
                 background-size:cover">
            </div>
            <div style="
                 display: table-cell;

                 width: 410px;
                 background-color: #ffffff;
                 padding: 40px 40px;

                 ">
                <h1
                    style="margin:0px; padding:0px"
                    class="mdc-typography--headline4" >Tenant Registration</h1>
                    
                    <div 
                        id="register-success"
                        class="mdc-typography mdc-typography--body" 
                        style="
                        display:none;
                        text-align: center; margin:120px 0px">
                        Almost done. Click the button bellow to try your new credentials and follow the on screen instructions. 
                        <br/>
                        <a style="margin:30px 0px; padding:16px 32px;"
                            class="mdc-button mdc-button--raised" href='/'>Enter Neuron Platform</a>
                    </div>
                    
                    <form 
                        id="register-ongoing"
                        style='display:block' autocomplete="off" name="registrationform" >
                    <table>
                        <tr>
                            <td colspan="2">
                                <p class="mdc-typography mdc-typography--body" >
                                    Register a tenant (business, organisation, etc) by choosing a tenant id:
                                    this is a reference so that we can locate your tenant workspace when you
                                    need help. You will need to create an tenant id, no whitespaces allowed, even if 
                                    you are a solo pilot or a single sensor operator. You can 
                                    use a domain name if you have one. 
                                </p>
                                <label  
                                    class="mdc-text-field mdc-text-field--outlined">
                                    <span class="mdc-notched-outline">
                                        <span class="mdc-notched-outline__leading"></span>
                                        <span class="mdc-notched-outline__notch">
                                            <span class="mdc-floating-label" id="my-label-id">Tenant ID</span>
                                        </span>
                                        <span class="mdc-notched-outline__trailing"></span>
                                    </span>
                                    <input 
                                        id="username"
                                        autocomplete="off"
                                        list="autocompleteOff" 
                                        type="text" 
                                        min="5"
                                        max="30"
                                        required 
                                        pattern="[^\s\\]*"
                                        class="newusername mdc-text-field__input" 
                                        aria-labelledby="my-label-id">

                                </label>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" class="mdc-typography mdc-typography--body" >
                                Primary tenant contact
                            </td>
                        </tr>
                        <tr>
                            <td style="width: 50%">
                                <label  
                                    class="mdc-text-field mdc-text-field--outlined">
                                    <span class="mdc-notched-outline">
                                        <span class="mdc-notched-outline__leading"></span>
                                        <span class="mdc-notched-outline__notch">
                                            <span class="mdc-floating-label" id="my-label-id">Name</span>
                                        </span>
                                        <span class="mdc-notched-outline__trailing"></span>
                                    </span>
                                    <input 
                                        id="firstname"
                                        autocomplete="off"
                                        list="autocompleteOff" 
                                        required
                                        type="text" 
                                        class="newusername mdc-text-field__input" 
                                        aria-labelledby="my-label-id">

                                </label>
                            </td>
                            <td>
                                <label class="mdc-text-field mdc-text-field--outlined">
                                    <span class="mdc-notched-outline">
                                        <span class="mdc-notched-outline__leading"></span>
                                        <span class="mdc-notched-outline__notch">
                                            <span class="mdc-floating-label" id="my-label-id">Surname</span>
                                        </span>
                                        <span class="mdc-notched-outline__trailing"></span>
                                    </span>
                                    <input 
                                        id="lastname"
                                        autocomplete="off"
                                        list="autocompleteOff" 
                                        required
                                        type="text" 
                                        class="newusername mdc-text-field__input" 
                                        aria-labelledby="my-label-id">

                                </label>

                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" class="mdc-typography mdc-typography--body" >
                                Tenant authentication
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <label  
                                    class="mdc-text-field mdc-text-field--outlined">
                                    <span class="mdc-notched-outline">
                                        <span class="mdc-notched-outline__leading"></span>
                                        <span class="mdc-notched-outline__notch">
                                            <span class="mdc-floating-label" id="my-label-id">Login email</span>
                                        </span>
                                        <span class="mdc-notched-outline__trailing"></span>
                                    </span>
                                    <input 
                                        id="email"
                                        autocomplete="new-password"
                                        list="autocompleteOff" 
                                        required
                                        type="email" 
                                        class="newusername mdc-text-field__input" 
                                        aria-labelledby="my-label-id">

                                </label>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <label  
                                    class="mdc-text-field mdc-text-field--outlined">
                                    <span class="mdc-notched-outline">
                                        <span class="mdc-notched-outline__leading"></span>
                                        <span class="mdc-notched-outline__notch">
                                            <span class="mdc-floating-label" id="my-label-id">Login Password</span>
                                        </span>
                                        <span class="mdc-notched-outline__trailing"></span>
                                    </span>
                                    {[
                                    <input 
                                        id="password"
                                        autocomplete="new-password"
                                        list="autocompleteOff" 
                                        required
                                        pattern=".{8,}"   
                                        title="8 characters minimum"
                                        type="password"
                                        class="newusername mdc-text-field__input" 
                                        aria-labelledby="my-label-id">
                                      ]}

                                </label>
                            </td>
                        </tr>

                        <tr >
                           
                            <td colspan="2" style="text-align:center">
                                <a href="#" onclick="submitForm()"
                                   
                                    style="width: 100%; padding:16px; margin: 16px 0px"
                                    class="mdc-button  mdc-button--raised">Register
                                </a> 
                            </td>
                        </tr>
                    </table>
                </form>


            </div>

        </div>



        <div id="snackbar" class="mdc-snackbar">
            <div class="mdc-snackbar__surface">
                <div class="mdc-snackbar__label" role="status" aria-live="polite">
                </div>
                <div class="mdc-snackbar__actions">
                    <button type="button" class="mdc-button mdc-snackbar__action">Ok</button>
                </div>
            </div>
        </div>

        {[
        <script>

            function showSnackBarMessage(message) {
                snackbarEl = document.getElementById("snackbar");
                snackbar = new mdc.snackbar.MDCSnackbar(snackbarEl);
                snackbar.labelText = message;
                snackbar.timeoutMs = 5000;
                snackbar.open();

            }
        </script>
        <script>
            function submitForm(e){
                if(document.registrationform.reportValidity()){
                    document.getElementById("register-ongoing").style.display = 'none';
                    document.getElementById("register-success").style.display = 'block';
                    document.getElementById("mega-image").style.background= "url(/images/drone-letter.jpg)";
                    //document.registrationform.submit();
                        var username = document.getElementById("username").value;
                        var email = document.getElementById("email").value;
                        var password = document.getElementById("password").value;
                        var firstname = document.getElementById("firstname").value;
                        var lastname = document.getElementById("lastname").value;
                        fetch(`/register/add/${username}/${email}/${password}/${firstname}/${lastname}`, {
                                method: 'POST'
                        }).then(response=>{
                            if (!response.ok) {
                                if(response.status == 409) {
                                    throw Error("There seems to be a conflict with an existing account (either same email or company name. Contact Neuron to resolve that issue");
                                } else if(response.status == 530) {
                                    throw Error("The string format is not acceptable. Remove any spaces and try again");
                                } else if(response.status == 531) {
                                    throw Error("Email format not acceptable.");
                                } else  {
                                    console.log(response);
                                    throw Error(response);
                                    
                                }
                            }
                            return response;
                        }).then(response=>{
                            console.log(response);
                            showSnackBarMessage("Company added to Neuron")
                        }).catch (e=>{
                            console.log(e);
                            alert(e);
                        });

                    
                    
                }
                return false;
            }
            
            
            var isMobile = false; //initiate as false
            // device detection
            if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)
                    || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0, 4))) {
                isMobile = true;
            }


            /* Material Design component initialisations and visual sugar coating. */


            progressbars = document.querySelectorAll('.mdc-linear-progress');
            progressbars.forEach(p => {
                _p = new mdc.linearProgress.MDCLinearProgress(progressbars[p]);
            });
            styleButtons();
            styleTextFields();
            styleTextFieldIcons();
            styleDropDowns();


            function styleDropDowns() {
                dropdowns = document.querySelectorAll('.mdc-select');
                for (i = 0; i < dropdowns.length; i++) {
                    //dropdowns[i].innerHTML = "<span class='mdc-button__ripple'></span>" + buttons[i].innerHTML;
                    d_dropdown = new mdc.select.MDCSelect(dropdowns[i]);
                }
            }

            function styleButtons() {
                buttons = document.querySelectorAll('.mdc-button');
                for (i = 0; i < buttons.length; i++) {
                    buttons[i].innerHTML = "<span class='mdc-button__ripple'></span>" + buttons[i].innerHTML;
                    d_button = new mdc.ripple.MDCRipple(buttons[i]);
                }
            }

            function styleSwitches() {
                switches = document.querySelectorAll('.mdc-switch');
                for (i = 0; i < switches.length; i++) {
                    switchControl_ = new mdc.switchControl.MDCSwitch(switches[i]);
                }

            }

            function styleTextFields() {
                textFields = document.querySelectorAll('.mdc-text-field');
                for (i = 0; i < textFields.length; i++) {
                    //textFields[i].insertAdjacentHTML("afterend",'<div class="mdc-text-field-helper-line"><div class="mdc-text-field-helper-text mdc-text-field-helper-text--validation-msg">helpme</div></div>');
                    textFields[i].innerHTML = "<span class='mdc-line-ripple'></span>" + textFields[i].innerHTML;
                    d_textFieldHelperText = new mdc.textField.MDCTextFieldHelperText(textFields[i].parentElement.querySelector('.mdc-text-field-helper-text'));
                    d_textField = new mdc.textField.MDCTextField(textFields[i]);
                }
            }

            function styleTextFieldIcons() {
                textFieldIcons = document.querySelectorAll('.mdc-text-field-icon');
                for (i = 0; i < textFieldIcons.length; i++) {
                    d_textFieldIcon = new mdc.textFieldIcon.MDCTextFieldIcon(textFieldIcons[i]);
                }
            }

            function styleDataTables() {
                dataTables = document.querySelector('.mdc-data-table');
                for (i = 0; i < dataTables.length; i++) {
                    d_textFieldIcon = new mdc.textFieldIcon.MDCTextFieldIcon(textFieldIcons[i]);
                    d_dataTable = new mdc.dataTable.MDCDataTable(dataTables[i]);
                }
            }

            function styleTabBar() {
                tabBar = new mdc.tabBar.MDCTabBar(document.querySelector('.mdc-tab-bar'));
            }


            function syntaxHighlight(json) {

                if (typeof json !== 'string') {
                    json = JSON.stringify(json, undefined, 2);
                }

                json = json.replace(/([^ -~-\n]+)/g, "Ħ");
                json = json.replace(/\\n/g, '\n\t\t');
                json = json.replace(/(^threadID:."\d+-\d+")/g, '');
                json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)|\b(credit|creditAck|settlePropose|settleProposeAck|settleInit|settleInitAck|paymentInit|paymentInitAck|paymentSent|paymentSentAck|settlePayment|settlePaymentAck|settleComplete|settleCompleteAck)\b/g, function (match) {
                    var cls = 'number';
                    if (/^"/.test(match)) {
                        if (/:$/.test(match)) {
                            cls = 'key';
                        } else {
                            cls = 'string';
                        }
                    } else if (/true|false/.test(match)) {
                        cls = 'boolean';
                    } else if (/null/.test(match)) {
                        cls = 'null';
                    } else if (/credit|creditAck|settlePropose|settleProposeAck|settleInit|settleInitAck|paymentInit|paymentInitAck|paymentSent|paymentSentAck|settlePayment|settlePaymentAck|settleComplete|settleCompleteAck/.test(match)) {
                        cls = 'mdc-chip';
                    }
                    return '<span class="' + cls + '">' + match + '</span>';
                });
            }





            function expand(thiselement) {
                var rdm = thiselement.parentElement.querySelector('.read-more-button');

                var moreText = thiselement.parentElement.querySelector('.read-more-expandable');

                if (rdm.style.display === "none") {
                    rdm.style.display = "inline";
                    moreText.style.display = "none";
                } else {
                    rdm.style.display = "none";

                    moreText.style.display = "inline";
                }
            }
        </script>
        ]}
    </body>

</html>
